---
import Frame from '../components/Frame.astro';
import type { GalleryPostEntry } from '../types/galleryPost';
import type { SizeAndPriceEntry } from '../types/sizeAndPrice';

interface Props {
    post: GalleryPostEntry;
}

const { post } = Astro.props;
const { fields } = post;

const imageUrl = fields.image.fields.file.url;
const imageWidth = fields.image.fields.file.details.image?.width || 800;
const imageHeight = fields.image.fields.file.details.image?.height || 600;
const title = fields.title;
const type = fields.type;
const price = fields.price;
const sizeAndPrice: SizeAndPriceEntry[] = fields.sizeAndPrice || [];

let lowestPrice: number | undefined;
if (type === 'print' && sizeAndPrice.length > 0) {
    lowestPrice = Math.min(...sizeAndPrice.map((item) => item.fields.price));
}

const displayPrice = type === 'print' ? lowestPrice : price;

const slug = title
    .toLowerCase()
    .replace(/\s+/g, '-')
    .replace(/[^\w-]+/g, '');
---

<a href={`/galleri/${slug}`} class='group flex flex-col h-full cursor-pointer'>
    <Frame
        src={imageUrl}
        alt={title}
        innerframe={true}
        width={imageWidth}
        height={imageHeight}
        outerFrameWidth={5}
        innerFrameWidth={0}
    />
    <div class='flex flex-row justify-between items-center mt-2 p-2'>
        <h2 class='text-xl font-bold truncate'>{title}</h2>
        {
            displayPrice !== undefined && (
                <span class='text-sm whitespace-nowrap'>
                    {type === 'print' ? 'Fra kr ' : 'kr '}
                    {displayPrice + ',00'}
                </span>
            )
        }
    </div>
</a>
